<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Les Bases de la Pomme de Terre - ED Moi</title>
    <link rel="stylesheet" href="/css/style_theme.css" />
    <link rel="stylesheet" href="/formations/css/cours_debutant_style.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header du cours -->
      <div class="cours-header">
        <span class="niveau-badge">D√©butant</span>
        <h1>Les Bases de la Pomme de Terre</h1>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">Question 0/8</div>
      </div>

      <!-- Questions -->
      <div id="questionsContainer"></div>

      <!-- Score final -->
      <div class="final-score" id="finalScore">
        <h2>üéâ Cours Termin√© !</h2>
        <div class="score-circle">
          <span class="score-number" id="finalScoreNumber">0/8</span>
        </div>
        <p class="score-message" id="scoreMessage"></p>
        <button class="btn-restart" onclick="restartQuiz()">Recommencer</button>
        <a href="/formations/cuisine/cuisine.html">
          <button class="btn-retour">Retour</button></a
        >
      </div>
    </div>

    <script>
      const questions = [
        {
          type: "qcm",
          question:
            "Quelle est la temp√©rature id√©ale pour cuire des pommes de terre au four ?",
          options: ["150¬∞C", "180¬∞C", "200¬∞C", "250¬∞C"],
          correct: 2,
        },
        {
          type: "vrai-faux",
          question:
            "Faut-il percer les pommes de terre avant la cuisson au four ?",
          options: ["Vrai", "Faux"],
          correct: 0,
        },
        {
          type: "qcm",
          question:
            "Quelle vari√©t√© de pomme de terre est id√©ale pour la pur√©e ?",
          options: ["Charlotte", "Bintje", "Ratte", "Vitelotte"],
          correct: 1,
        },
        {
          type: "ordre",
          question: "Dans quel ordre faut-il pr√©parer des smash potatoes ?",
          options: [
            "Faire bouillir les pommes de terre",
            "Les √©craser l√©g√®rement",
            "Les badigeonner d'huile",
            "Les cuire au four jusqu'√† dor√©es",
          ],
          correct: [0, 1, 2, 3],
        },
        {
          type: "qcm",
          question:
            "Quel est le temps de cuisson moyen pour des pommes de terre bouillies ?",
          options: [
            "10-15 minutes",
            "20-25 minutes",
            "35-40 minutes",
            "50-60 minutes",
          ],
          correct: 1,
        },
        {
          type: "multiple",
          question:
            "Quelles m√©thodes de cuisson conviennent aux pommes de terre ? (plusieurs r√©ponses)",
          options: ["√Ä l'eau", "Au four", "√Ä la vapeur", "Au micro-ondes"],
          correct: [0, 1, 2, 3],
        },
        {
          type: "vrai-faux",
          question:
            "Il faut toujours √©plucher les pommes de terre avant de les cuire.",
          options: ["Vrai", "Faux"],
          correct: 1,
        },
        {
          type: "qcm",
          question: "Quelle pomme de terre est parfaite pour les frites ?",
          options: ["Agata", "Bintje", "Roseval", "Belle de Fontenay"],
          correct: 1,
        },
      ];

      let currentQuestion = 0;
      let score = 0;
      let userAnswers = [];

      function initQuiz() {
        displayQuestion();
        updateProgress();
      }

      function displayQuestion() {
        const container = document.getElementById("questionsContainer");
        container.innerHTML = "";

        const q = questions[currentQuestion];
        const card = document.createElement("div");
        card.className = "question-card active";

        let optionsHTML = "";

        if (q.type === "ordre") {
          optionsHTML = '<div class="drag-options" id="dragContainer">';
          q.options.forEach((opt, idx) => {
            optionsHTML += `
                        <div class="drag-item" draggable="true" data-index="${idx}">
                            <span class="drag-number">${idx + 1}</span>
                            <span>${opt}</span>
                        </div>
                    `;
          });
          optionsHTML += "</div>";
        } else {
          optionsHTML = '<div class="options">';
          q.options.forEach((opt, idx) => {
            const isMultiple =
              q.type === "multiple" ? 'data-multiple="true"' : "";
            optionsHTML += `
                        <div class="option" data-index="${idx}" ${isMultiple} onclick="selectOption(${idx})">
                            ${opt}
                        </div>
                    `;
          });
          optionsHTML += "</div>";
        }

        card.innerHTML = `
                <div class="question-number">Question ${currentQuestion + 1}/${
          questions.length
        }</div>
                <div class="question-type">${getQuestionTypeLabel(q.type)}</div>
                <div class="question-text">${q.question}</div>
                ${optionsHTML}
                <div class="feedback" id="feedback"></div>
                <div class="buttons-container">
                    <button class="btn btn-validate" onclick="validateAnswer()">Valider</button>
                    <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">Suivant ‚Üí</button>
                </div>
            `;

        container.appendChild(card);

        if (q.type === "ordre") {
          initDragAndDrop();
        }
      }

      function getQuestionTypeLabel(type) {
        const labels = {
          qcm: "QCM - Choix unique",
          "vrai-faux": "Vrai ou Faux",
          ordre: "Ordre chronologique",
          multiple: "S√©lection multiple",
        };
        return labels[type] || type;
      }

      function selectOption(index) {
        const q = questions[currentQuestion];
        const options = document.querySelectorAll(".option");

        if (q.type === "multiple") {
          // Pour les questions √† choix multiples
          options[index].classList.toggle("selected");
        } else {
          // Pour QCM et Vrai/Faux
          options.forEach((opt) => opt.classList.remove("selected"));
          options[index].classList.add("selected");
        }
      }

      function initDragAndDrop() {
        const items = document.querySelectorAll(".drag-item");
        const container = document.getElementById("dragContainer");

        items.forEach((item) => {
          item.addEventListener("dragstart", handleDragStart);
          item.addEventListener("dragover", handleDragOver);
          item.addEventListener("drop", handleDrop);
          item.addEventListener("dragend", handleDragEnd);
        });

        let draggedItem = null;

        function handleDragStart(e) {
          draggedItem = this;
          this.style.opacity = "0.5";
        }

        function handleDragOver(e) {
          e.preventDefault();
          return false;
        }

        function handleDrop(e) {
          e.stopPropagation();
          if (draggedItem !== this) {
            const allItems = [...container.querySelectorAll(".drag-item")];
            const draggedIndex = allItems.indexOf(draggedItem);
            const targetIndex = allItems.indexOf(this);

            if (draggedIndex < targetIndex) {
              this.parentNode.insertBefore(draggedItem, this.nextSibling);
            } else {
              this.parentNode.insertBefore(draggedItem, this);
            }

            updateDragNumbers();
          }
          return false;
        }

        function handleDragEnd(e) {
          this.style.opacity = "1";
        }

        function updateDragNumbers() {
          const items = container.querySelectorAll(".drag-item");
          items.forEach((item, idx) => {
            item.querySelector(".drag-number").textContent = idx + 1;
          });
        }
      }

      function validateAnswer() {
        const q = questions[currentQuestion];
        let isCorrect = false;
        let userAnswer = null;

        if (q.type === "ordre") {
          const items = document.querySelectorAll(".drag-item");
          userAnswer = Array.from(items).map((item) =>
            parseInt(item.dataset.index)
          );
          isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.correct);
        } else if (q.type === "multiple") {
          const selected = document.querySelectorAll(".option.selected");
          userAnswer = Array.from(selected)
            .map((opt) => parseInt(opt.dataset.index))
            .sort();
          isCorrect =
            JSON.stringify(userAnswer) === JSON.stringify(q.correct.sort());
        } else {
          const selected = document.querySelector(".option.selected");
          if (selected) {
            userAnswer = parseInt(selected.dataset.index);
            isCorrect = userAnswer === q.correct;
          }
        }

        if (userAnswer === null && q.type !== "ordre") {
          alert("Veuillez s√©lectionner une r√©ponse !");
          return;
        }

        userAnswers.push(userAnswer);
        if (isCorrect) score++;

        // Afficher le feedback
        const feedback = document.getElementById("feedback");
        feedback.className =
          "feedback show " + (isCorrect ? "correct" : "incorrect");
        feedback.textContent = isCorrect
          ? "‚úì Bonne r√©ponse !"
          : "‚úó Mauvaise r√©ponse";

        // Marquer les r√©ponses
        if (q.type !== "ordre") {
          const options = document.querySelectorAll(".option");
          options.forEach((opt, idx) => {
            opt.classList.add("disabled");
            if (q.type === "multiple") {
              if (q.correct.includes(idx)) {
                opt.classList.add("correct");
              }
            } else {
              if (idx === q.correct) {
                opt.classList.add("correct");
              }
              if (idx === userAnswer && !isCorrect) {
                opt.classList.add("incorrect");
              }
            }
          });
        }

        // Afficher le bouton suivant
        document.querySelector(".btn-validate").style.display = "none";
        document.getElementById("nextBtn").classList.add("show");
      }

      function nextQuestion() {
        currentQuestion++;
        if (currentQuestion < questions.length) {
          displayQuestion();
          updateProgress();
        } else {
          showFinalScore();
        }
      }

      function updateProgress() {
        const progress = (currentQuestion / questions.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById(
          "progressText"
        ).textContent = `Question ${currentQuestion}/${questions.length}`;
      }

      function showFinalScore() {
        document.getElementById("questionsContainer").style.display = "none";
        document.querySelector(".cours-header").style.display = "none";

        const finalScore = document.getElementById("finalScore");
        const scoreNumber = document.getElementById("finalScoreNumber");
        const scoreMessage = document.getElementById("scoreMessage");

        scoreNumber.textContent = `${score}/${questions.length}`;

        const percentage = (score / questions.length) * 100;
        if (percentage === 100) {
          scoreMessage.textContent = "Parfait ! Vous ma√Ætrisez le sujet !";
        } else if (percentage >= 75) {
          scoreMessage.textContent = "Tr√®s bien ! Excellent travail !";
        } else if (percentage >= 50) {
          scoreMessage.textContent = "Bien jou√© ! Continuez comme √ßa !";
        } else {
          scoreMessage.textContent = "Vous pouvez progresser, r√©essayez !";
        }

        finalScore.classList.add("show");
      }

      function restartQuiz() {
        currentQuestion = 0;
        score = 0;
        userAnswers = [];
        document.getElementById("finalScore").classList.remove("show");
        document.getElementById("questionsContainer").style.display = "block";
        document.querySelector(".cours-header").style.display = "block";
        initQuiz();
      }

      // Initialiser le quiz au chargement
      initQuiz();
    </script>
  </body>
  <script src="/script.js"></script>
</html>
