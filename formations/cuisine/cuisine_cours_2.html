<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cuisine Cr√©ative - ED Moi</title>
    <link rel="stylesheet" href="/css/style_theme.css" />
    <link rel="stylesheet" href="/formations/css/cours_intermediaire.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header du cours -->
      <div class="cours-header">
        <span class="niveau-badge">Interm√©diaire</span>
        <h1>Cuisine Cr√©ative : Associations Audacieuses</h1>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">Question 0/9</div>
      </div>

      <!-- Questions -->
      <div id="questionsContainer"></div>

      <!-- Score final -->
      <div class="final-score" id="finalScore">
        <h2>üéâ Cours Termin√© !</h2>
        <div class="score-circle">
          <span class="score-number" id="finalScoreNumber">0/9</span>
        </div>
        <p class="score-message" id="scoreMessage"></p>
        <button class="btn-restart" onclick="restartQuiz()">Recommencer</button
        ><a href="/formations/cuisine/cuisine.html">
          <button class="btn-retour">Retour</button></a
        >
      </div>
    </div>

    <script>
      const questions = [
        {
          type: "multiple",
          question:
            "Quels fromages peuvent √™tre utilis√©s dans une raclette revisit√©e ? (plusieurs r√©ponses)",
          options: ["Raclette traditionnelle", "Morbier", "Reblochon", "Comt√©"],
          correct: [0, 1, 2, 3],
        },
        {
          type: "qcm",
          question:
            "Quel ingr√©dient peut apporter une touche sucr√©e-sal√©e √† un plat principal ?",
          options: ["Miel", "Vinaigre blanc", "Citron", "Moutarde"],
          correct: 0,
        },
        {
          type: "ordre",
          question: "Dans quel ordre pr√©parer un millefeuille sal√© ?",
          options: [
            "Pr√©parer la p√¢te feuillet√©e",
            "Cuire les feuilles au four",
            "Pr√©parer la garniture",
            "Monter en alternant p√¢te et garniture",
          ],
          correct: [0, 1, 2, 3],
        },
        {
          type: "vrai-faux",
          question:
            "La cuisson au four est adapt√©e pour un g√¢teau de raclette (type parmentier) ?",
          options: ["Vrai", "Faux"],
          correct: 0,
        },
        {
          type: "multiple",
          question:
            "Quelles √©pices rehaussent le go√ªt du fromage fondu ? (plusieurs r√©ponses)",
          options: ["Poivre noir", "Paprika fum√©", "Noix de muscade", "Cumin"],
          correct: [0, 1, 2, 3],
        },
        {
          type: "qcm",
          question:
            "Quelle temp√©rature est id√©ale pour faire fondre du fromage sans le br√ªler ?",
          options: ["100-120¬∞C", "150-180¬∞C", "200-220¬∞C", "250¬∞C+"],
          correct: 1,
        },
        {
          type: "vrai-faux",
          question:
            "Le chocolat noir peut s'associer avec des plats sal√©s comme le gibier ?",
          options: ["Vrai", "Faux"],
          correct: 0,
        },
        {
          type: "qcm",
          question: "Quel fruit se marie bien avec du fromage de ch√®vre ?",
          options: ["Banane", "Ananas", "Figue", "Kiwi"],
          correct: 2,
        },
        {
          type: "multiple",
          question:
            "Quels √©l√©ments apportent du croquant dans une pr√©sentation ? (plusieurs r√©ponses)",
          options: [
            "Noix grill√©es",
            "Chips de l√©gumes",
            "Graines torr√©fi√©es",
            "Cro√ªtons",
          ],
          correct: [0, 1, 2, 3],
        },
      ];

      let currentQuestion = 0;
      let score = 0;
      let userAnswers = [];

      function initQuiz() {
        displayQuestion();
        updateProgress();
      }

      function displayQuestion() {
        const container = document.getElementById("questionsContainer");
        container.innerHTML = "";

        const q = questions[currentQuestion];
        const card = document.createElement("div");
        card.className = "question-card active";

        let optionsHTML = "";

        if (q.type === "ordre") {
          optionsHTML = '<div class="drag-options" id="dragContainer">';
          q.options.forEach((opt, idx) => {
            optionsHTML += `
                        <div class="drag-item" draggable="true" data-index="${idx}">
                            <span class="drag-number">${idx + 1}</span>
                            <span>${opt}</span>
                        </div>
                    `;
          });
          optionsHTML += "</div>";
        } else {
          optionsHTML = '<div class="options">';
          q.options.forEach((opt, idx) => {
            const isMultiple =
              q.type === "multiple" ? 'data-multiple="true"' : "";
            optionsHTML += `
                        <div class="option" data-index="${idx}" ${isMultiple} onclick="selectOption(${idx})">
                            ${opt}
                        </div>
                    `;
          });
          optionsHTML += "</div>";
        }

        card.innerHTML = `
                <div class="question-number">Question ${currentQuestion + 1}/${
          questions.length
        }</div>
                <div class="question-type">${getQuestionTypeLabel(q.type)}</div>
                <div class="question-text">${q.question}</div>
                ${optionsHTML}
                <div class="feedback" id="feedback"></div>
                <div class="buttons-container">
                    <button class="btn btn-validate" onclick="validateAnswer()">Valider</button>
                    <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">Suivant ‚Üí</button>
                </div>
            `;

        container.appendChild(card);

        if (q.type === "ordre") {
          initDragAndDrop();
        }
      }

      function getQuestionTypeLabel(type) {
        const labels = {
          qcm: "QCM - Choix unique",
          "vrai-faux": "Vrai ou Faux",
          ordre: "Ordre chronologique",
          multiple: "S√©lection multiple",
        };
        return labels[type] || type;
      }

      function selectOption(index) {
        const q = questions[currentQuestion];
        const options = document.querySelectorAll(".option");

        if (q.type === "multiple") {
          options[index].classList.toggle("selected");
        } else {
          options.forEach((opt) => opt.classList.remove("selected"));
          options[index].classList.add("selected");
        }
      }

      function initDragAndDrop() {
        const items = document.querySelectorAll(".drag-item");
        const container = document.getElementById("dragContainer");

        items.forEach((item) => {
          item.addEventListener("dragstart", handleDragStart);
          item.addEventListener("dragover", handleDragOver);
          item.addEventListener("drop", handleDrop);
          item.addEventListener("dragend", handleDragEnd);
        });

        let draggedItem = null;

        function handleDragStart(e) {
          draggedItem = this;
          this.style.opacity = "0.5";
        }

        function handleDragOver(e) {
          e.preventDefault();
          return false;
        }

        function handleDrop(e) {
          e.stopPropagation();
          if (draggedItem !== this) {
            const allItems = [...container.querySelectorAll(".drag-item")];
            const draggedIndex = allItems.indexOf(draggedItem);
            const targetIndex = allItems.indexOf(this);

            if (draggedIndex < targetIndex) {
              this.parentNode.insertBefore(draggedItem, this.nextSibling);
            } else {
              this.parentNode.insertBefore(draggedItem, this);
            }

            updateDragNumbers();
          }
          return false;
        }

        function handleDragEnd(e) {
          this.style.opacity = "1";
        }

        function updateDragNumbers() {
          const items = container.querySelectorAll(".drag-item");
          items.forEach((item, idx) => {
            item.querySelector(".drag-number").textContent = idx + 1;
          });
        }
      }

      function validateAnswer() {
        const q = questions[currentQuestion];
        let isCorrect = false;
        let userAnswer = null;

        if (q.type === "ordre") {
          const items = document.querySelectorAll(".drag-item");
          userAnswer = Array.from(items).map((item) =>
            parseInt(item.dataset.index)
          );
          isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.correct);
        } else if (q.type === "multiple") {
          const selected = document.querySelectorAll(".option.selected");
          userAnswer = Array.from(selected)
            .map((opt) => parseInt(opt.dataset.index))
            .sort();
          isCorrect =
            JSON.stringify(userAnswer) === JSON.stringify(q.correct.sort());
        } else {
          const selected = document.querySelector(".option.selected");
          if (selected) {
            userAnswer = parseInt(selected.dataset.index);
            isCorrect = userAnswer === q.correct;
          }
        }

        if (userAnswer === null && q.type !== "ordre") {
          alert("Veuillez s√©lectionner une r√©ponse !");
          return;
        }

        userAnswers.push(userAnswer);
        if (isCorrect) score++;

        const feedback = document.getElementById("feedback");
        feedback.className =
          "feedback show " + (isCorrect ? "correct" : "incorrect");
        feedback.textContent = isCorrect
          ? "‚úì Bonne r√©ponse !"
          : "‚úó Mauvaise r√©ponse";

        if (q.type !== "ordre") {
          const options = document.querySelectorAll(".option");
          options.forEach((opt, idx) => {
            opt.classList.add("disabled");
            if (q.type === "multiple") {
              if (q.correct.includes(idx)) {
                opt.classList.add("correct");
              }
            } else {
              if (idx === q.correct) {
                opt.classList.add("correct");
              }
              if (idx === userAnswer && !isCorrect) {
                opt.classList.add("incorrect");
              }
            }
          });
        }

        document.querySelector(".btn-validate").style.display = "none";
        document.getElementById("nextBtn").classList.add("show");
      }

      function nextQuestion() {
        currentQuestion++;
        if (currentQuestion < questions.length) {
          displayQuestion();
          updateProgress();
        } else {
          showFinalScore();
        }
      }

      function updateProgress() {
        const progress = (currentQuestion / questions.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById(
          "progressText"
        ).textContent = `Question ${currentQuestion}/${questions.length}`;
      }

      function showFinalScore() {
        document.getElementById("questionsContainer").style.display = "none";
        document.querySelector(".cours-header").style.display = "none";

        const finalScore = document.getElementById("finalScore");
        const scoreNumber = document.getElementById("finalScoreNumber");
        const scoreMessage = document.getElementById("scoreMessage");

        scoreNumber.textContent = `${score}/${questions.length}`;

        const percentage = (score / questions.length) * 100;
        if (percentage === 100) {
          scoreMessage.textContent = "Parfait ! Vous √™tes un chef cr√©atif !";
        } else if (percentage >= 75) {
          scoreMessage.textContent =
            "Tr√®s bien ! Vos associations sont audacieuses !";
        } else if (percentage >= 50) {
          scoreMessage.textContent = "Bien jou√© ! Continuez √† exp√©rimenter !";
        } else {
          scoreMessage.textContent =
            "Continuez √† pratiquer, la cr√©ativit√© vient avec l'exp√©rience !";
        }

        finalScore.classList.add("show");
      }

      function restartQuiz() {
        currentQuestion = 0;
        score = 0;
        userAnswers = [];
        document.getElementById("finalScore").classList.remove("show");
        document.getElementById("questionsContainer").style.display = "block";
        document.querySelector(".cours-header").style.display = "block";
        initQuiz();
      }

      initQuiz();
    </script>
  </body>
  <script src="/script.js"></script>
</html>
